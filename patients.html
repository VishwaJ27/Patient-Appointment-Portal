<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Patients — Pennilson Lifeline Admin</title>
  <link href="https://fonts.googleapis.com/css2?family=Cormorant+Garamond:wght@400;500;600&family=DM+Sans:wght@300;400;500&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="{{ url_for('static', filename='admin/admin.css') }}">
</head>
<body>

<!-- SIDEBAR  -->
<aside class="sidebar">
  <div class="sidebar-logo">
    <div class="mark">PL</div>
    <h2>Pennilson Lifeline</h2>
    <p>Admin Panel</p>
  </div>
  <nav class="sidebar-nav">
    <div class="nav-label">Main</div>
    <a class="nav-item" href="/admin">
      <svg width="16" height="16" fill="none" stroke="currentColor" stroke-width="1.8" viewBox="0 0 24 24"><rect x="3" y="3" width="7" height="7" rx="1"/><rect x="14" y="3" width="7" height="7" rx="1"/><rect x="3" y="14" width="7" height="7" rx="1"/><rect x="14" y="14" width="7" height="7" rx="1"/></svg>
      Dashboard
    </a>
    <a class="nav-item active" href="/admin/patients">
      <svg width="16" height="16" fill="none" stroke="currentColor" stroke-width="1.8" viewBox="0 0 24 24"><path d="M17 21v-2a4 4 0 00-4-4H5a4 4 0 00-4 4v2"/><circle cx="9" cy="7" r="4"/><path d="M23 21v-2a4 4 0 00-3-3.87M16 3.13a4 4 0 010 7.75"/></svg>
      Patients
    </a>
    <a class="nav-item" href="/admin/appointments">
      <svg width="16" height="16" fill="none" stroke="currentColor" stroke-width="1.8" viewBox="0 0 24 24"><rect x="3" y="4" width="18" height="18" rx="2"/><path d="M16 2v4M8 2v4M3 10h18"/></svg>
      Appointments
    </a>
    <div class="nav-label">Actions</div>
    <a class="nav-item" href="/">
      <svg width="16" height="16" fill="none" stroke="currentColor" stroke-width="1.8" viewBox="0 0 24 24"><path d="M12 5v14M5 12l7-7 7 7"/></svg>
      New Appointment
    </a>
  </nav>
  <div class="sidebar-footer">&copy; 2024 Pennilson Lifeline</div>
</aside>

<!-- MAIN  -->
<div class="main">

  <div class="topbar">
    <h1>Patients</h1>
    <div class="topbar-right">
      <span class="topbar-badge">{{ patients|length }} total</span>
      <a href="/" class="btn-primary">
        <svg width="14" height="14" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path d="M12 5v14M5 12h14"/></svg>
        New Appointment
      </a>
    </div>
  </div>

  <div class="page">

    <!-- TOOLBAR -->
    <div class="toolbar">
      <div class="search-wrap">
        <svg width="15" height="15" fill="none" stroke="#8a9bb0" stroke-width="1.8" viewBox="0 0 24 24"><circle cx="11" cy="11" r="8"/><path d="M21 21l-4.35-4.35"/></svg>
        <input class="search-input" id="searchInput" type="text" placeholder="Search by name, email, phone...">
      </div>
      <select class="filter-select" id="filterGender">
        <option value="">All Genders</option>
        <option>Male</option>
        <option>Female</option>
        <option>Non-binary</option>
        <option>Prefer not to say</option>
      </select>
      <select class="filter-select" id="filterBlood">
        <option value="">All Blood Groups</option>
        <option>A+</option><option>A-</option>
        <option>B+</option><option>B-</option>
        <option>O+</option><option>O-</option>
        <option>AB+</option><option>AB-</option>
      </select>
    </div>

    <!-- TABLE -->
    <div class="table-wrap">
      <div class="table-header">
        <div class="table-title">All Patients</div>
        <div class="table-count" id="tableCount">{{ patients|length }} records</div>
      </div>

      {% if patients %}
      <div style="overflow-x:auto;">
        <table id="patientsTable">
          <thead>
            <tr>
              <th>#</th>
              <th>Full Name</th>
              <th>Date of Birth</th>
              <th>Gender</th>
              <th>Blood Group</th>
              <th>Phone</th>
              <th>Email</th>
              <th>Address</th>
              <th>Registered On</th>
            </tr>
          </thead>
          <tbody>
            {% for p in patients %}
            <tr
              data-name="{{ p.full_name|lower }}"
              data-email="{{ p.email|lower }}"
              data-phone="{{ p.phone|lower }}"
              data-gender="{{ p.gender }}"
              data-blood="{{ p.blood_group }}"
            >
              <td style="color:var(--muted);font-size:0.78rem;">{{ loop.index }}</td>
              <td><div class="patient-name">{{ p.full_name }}</div></td>
              <td>{{ p.dob }}</td>
              <td>{{ p.gender }}</td>
              <td>
                <span class="blood-badge">{{ p.blood_group }}</span>
              </td>
              <td>{{ p.phone }}</td>
              <td>{{ p.email }}</td>
              <td style="max-width:160px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;">{{ p.address or '—' }}</td>
              <td style="font-size:0.78rem;color:var(--muted);">{{ p.created_at }}</td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
      {% else %}
      <div class="empty-state">
        <svg width="56" height="56" fill="none" stroke="#8a9bb0" stroke-width="1.5" viewBox="0 0 24 24"><path d="M17 21v-2a4 4 0 00-4-4H5a4 4 0 00-4 4v2"/><circle cx="9" cy="7" r="4"/></svg>
        <p>No patients registered yet.</p>
      </div>
      {% endif %}
    </div>

  </div>
</div>

<script src="{{ url_for('static', filename='admin/admin.js') }}"></script>
<script>
  // Patients-specific filter
  bindFilter('patientsTable', 'tableCount', [
    { inputId: 'searchInput',  type: 'search', fields: ['name','email','phone'] },
    { inputId: 'filterGender', type: 'exact',  field: 'gender' },
    { inputId: 'filterBlood',  type: 'exact',  field: 'blood' },
  ]);
</script>
</body>
</html>